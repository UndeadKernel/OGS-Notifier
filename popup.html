<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script type="text/javascript" src="functions.js"></script>
<link rel="stylesheet" type="text/css" href="style.css" />

<div class='content-wrapper'>
    <div id="login-wrapper">

        <span class='alert'>Error: not logged in</span>

        <fieldset class="menulogin">
            <legend>Login</legend>

            <table>
                <tr> 
                    <td> <label style="float:left;">User</label> </td>
                    <td>
                        <div class="menulogin">
                            <input type="text" name="userName" value="" id="username" class="menulogin"/>
                            <input type="hidden" name="validLoginAttempt" value="1" />
                        </div>
                    </td>
                </tr>
                <tr> 
                    <td> <label style="float:left;">Password</label> </td>
                    <td>
                        <div class="menulogin">
                            <input type="password" name="passWord" id="password" value="" class="menulogin"/>
                        </div>
                    </td>
                </tr>
                <tr> 
                    <td>
                        <input id='submit' style="width:100%; margin: 10px 0;" type="submit" value="Log In" />
                    </td>
                    <td style="text-align:right;">
                        <a class="main" href="javascript:gotoLogin();">Open Login Page</a>
                    </td>
                </tr>
            </table>

            <div style="display:none;" id="message"></div>
        </fieldset>
    </div>
</div>

<script>

    var root = localStorage['url'];
    var view = localStorage['include_viewed'] == 'on' ? "" : "?only_unviewed=true";

    function gotoLogin() {
        chrome.tabs.create( {url: root+"/login.php"} );
    }

    // check if loggged in
    var response;

    if (localStorage['logged-in'] === 'false') {

        $('#login-wrapper').show();

        // on submission, create a new tab, send the login information
        $('#submit').click( function(event) {

            $.ajax({
                type: 'POST',
                url: root+"/includes/functions/ajax/login.php",
                data: {passWord: $('#password').attr("value"), userName: $('#username').attr("value")},
                success: function(response){
                    if (response == 'ok') {
                        localStorage['logged-in'] = true;
                        update();
                    }
                    $('#message').html(response);
                    $('#message').show();
                    setTimeout( function() { $('#message').hide();} , 5000);
                }
            });

            event.stopPropagation();
        });

    } else {
        chrome.tabs.create( {url: root+"/login.php"} );
        window.close();

        $('#login-wrapper').hide();
    }

</script>


<!-- do XML parsing -->
